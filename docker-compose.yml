# PortfolioOS — Docker Compose
#
# Usage:
#   docker compose up --build        Build and run the app
#   docker compose up                Run (after initial build)
#   docker compose run app test      Run tests inside the container
#
# X11 forwarding (Linux):
#   Run `xhost +local:docker` before starting to allow display access.
#
# macOS / Windows:
#   Install an X11 server (XQuartz on macOS, VcXsrv on Windows),
#   then set DISPLAY appropriately. See README for details.

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: portfolioos
    environment:
      - DISPLAY=${DISPLAY:-:0}
      # LM Studio endpoint (host network accessible via host.docker.internal)
      - LM_STUDIO_ENDPOINT=${LM_STUDIO_ENDPOINT:-http://host.docker.internal:1234/v1}
      # Optional cloud LLM keys (opt-in only)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      - FRED_API_KEY=${FRED_API_KEY:-}
    volumes:
      # X11 socket for display forwarding (Linux)
      - /tmp/.X11-unix:/tmp/.X11-unix:ro
      # Persistent data — survives container restarts
      - portfolioos-data:/home/portfolioos/.portfolioos
    # Share IPC namespace for Electron/Chromium shared memory
    ipc: host
    # Required for Electron's sandbox
    security_opt:
      - seccomp:unconfined
    networks:
      - portfolioos-net

volumes:
  portfolioos-data:
    driver: local

networks:
  portfolioos-net:
    driver: bridge
